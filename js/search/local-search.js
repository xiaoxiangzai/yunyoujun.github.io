const mergeIntoSlice=(t,e,n)=>{var o;let{position:r,word:l}=o=n[0];const i=[],s=new Set;for(;r+l.length<=e&&0!==n.length;){s.add(l),i.push({position:r,length:l.length});var h=r+l.length;for(n.shift();0!==n.length&&(o=n[0],r=o.position,l=o.word,h>r);)n.shift()}return{hits:i,start:t,end:e,count:s.size}},getIndexByWord=(t,r,l=!1)=>{const i=[],s=new Set;return t.forEach(e=>{var n=e.length;if(0!==n){let t=0;var o;for(l||(r=r.toLowerCase(),e=e.toLowerCase());-1<(o=r.indexOf(e,t));)i.push({position:o,word:e}),s.add(e),t=o+n}}),i.sort((t,e)=>t.position!==e.position?t.position-e.position:e.word.length-t.word.length),[i,s]},highlightKeyword=(t,e)=>{let n="",o=e.start;for(var{position:r,length:l}of e.hits)n+=t.substring(o,r),o=r+l,n+=`<mark class="search-keyword">${t.substr(r,l)}</mark>`;return n+=t.substring(o,e.end),n},localSearch=(t,e,n)=>{if(t){let o=[];const r=document.getElementById(e),l=document.getElementById(n);(()=>{const e=!t.endsWith("json");fetch(t).then(t=>t.text()).then(t=>{o=e?[...(new DOMParser).parseFromString(t,"text/xml").querySelectorAll("entry")].map(t=>({title:t.querySelector("title").textContent,content:t.querySelector("content").textContent,url:t.querySelector("url").textContent})):JSON.parse(t),o=o.filter(t=>t.title).map(t=>(t.title=t.title.trim(),t.content=t.content?t.content.trim().replace(/<[^>]+>/g,""):"",t.url=decodeURIComponent(t.url).replace(/\/{2,}/g,"/"),t)),r&&r.addEventListener("input",()=>{const t=r.value.trim().toLowerCase();var e=t.split(/[-\s]+/);let n=[];0<t.length&&(n=(d=>{const g=[];return o.forEach(({title:n,content:o,url:r})=>{var[l,i]=getIndexByWord(d,n),[s,h]=getIndexByWord(d,o),i=new Set([...i,...h]).size,h=l.length+s.length;if(0!==h){const u=[];0!==l.length&&u.push(mergeIntoSlice(0,n.length,l));let t=[];for(;0!==s.length;){var a=s[0]["position"],c=Math.max(0,a-20),a=Math.min(o.length,a+80);t.push(mergeIntoSlice(c,a,s))}t.sort((t,e)=>t.count!==e.count?e.count-t.count:t.hits.length!==e.hits.length?e.hits.length-t.hits.length:t.start-e.start);let e="";(r=new URL(r,location.origin)).searchParams.append("highlight",d.join(" ")),0!==u.length?e+=`<li><a href="${r.href}" class="search-result-title">${highlightKeyword(n,u[0])}</a>`:e+=`<li><a href="${r.href}" class="search-result-title">${n}</a>`,t.forEach(t=>{e+=`<a href="${r.href}"><p class="search-result">${highlightKeyword(o,t)}...</p></a>`}),e+="</li>",g.push({item:e,id:g.length,hitCount:h,includedCount:i})}}),g})(e)),n.sort((t,e)=>t.includedCount!==e.includedCount?e.includedCount-t.includedCount:t.hitCount!==e.hitCount?e.hitCount-t.hitCount:e.id-t.id);e=CONFIG.i18n.hits.replace(/\$\{hits}/,n.length);l.innerHTML=`<div class="search-stats">${e}</div>
            <ul class="search-result-list">${n.map(t=>t.item).join("")}</ul>`})})})()}else console.warn("`hexo-generator-searchdb` plugin is not installed!")};document.addEventListener("DOMContentLoaded",()=>{localSearch(CONFIG.local_search.path,"local-search-input","local-search-result")});